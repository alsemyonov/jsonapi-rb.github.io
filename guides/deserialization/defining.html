<!doctype html>
<html>
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">

    <title>jsonapi-rb</title>

    <link href="/stylesheets/toolkit.css" rel="stylesheet" />
    <link href="/stylesheets/solarized.css" rel="stylesheet" />
    <link href="/stylesheets/application.css" rel="stylesheet" />
    <link href="/stylesheets/guides.css" rel="stylesheet" />
  </head>

  <body>
    <nav class="navbar navbar-default navbar-static-top navbar-padded text-uppercase app-navbar">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed p-x-0" data-toggle="collapse" data-target="#navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">
        <span>jsonapi-rb</span>
      </a>
    </div>
    <div class="navbar-collapse collapse" id="navbar-collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a href="/guides">Guides</a>
        </li>
        <li>
          <a href="/contributors.html">Contributors</a>
        </li>
        <li>
          <a href="https://github.com/jsonapi-rb" target="_blank">Source Code</a>
        </li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</nav>

    <div class="container docs-content">
      <ul id="markdown-toc">
        <li></li>
        <li class="toc-group">
          <a href="/guides">Introduction</a>
        </li>
        <li class="toc-group">
          <a href="/guides/serialization">Serialization</a>
          <ul>
            <li><a href="/guides/serialization/defining.html">Defining resources</a></li>
            <li><a href="/guides/serialization/rendering.html">Rendering resources</a></li>
            <li><a href="/guides/serialization/errors.html">Rendering errors</a></li>
          </ul>
        </li>
        <li class="toc-group">
          <a href="/guides/deserialization">Deserialization</a>
          <ul>
            <li><a href="/guides/deserialization/defining.html">Defining resources</a></li>
            <li><a href="/guides/deserialization/deserializing.html">Deserializing resources</a></li>
          </ul>
        </li>
      </ul>
      <h1>Deserialization - Defining deserializable resources</h1>

<p>Deserializable resources are defined by subclassing
<code>JSONAPI::Deserializable::Resource</code> and using its DSL.</p>

<p>Example:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">DeserializablePost</span> <span class="o">&lt;</span> <span class="no">JSONAPI</span><span class="o">::</span><span class="no">Deserializable</span><span class="o">::</span><span class="no">Resource</span>
  <span class="n">type</span>
  <span class="nb">id</span>
  <span class="n">attribute</span> <span class="ss">:title</span>

  <span class="n">attribute</span> <span class="ss">:date</span> <span class="k">do</span> <span class="o">|</span><span class="kp">attr</span><span class="o">|</span>
    <span class="n">field</span> <span class="ss">created_at: </span><span class="kp">attr</span>
  <span class="k">end</span>

  <span class="n">relationship</span> <span class="ss">:author</span> <span class="k">do</span> <span class="o">|</span><span class="n">_rel</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">type</span><span class="o">|</span>
    <span class="n">field</span> <span class="ss">author_id: </span><span class="nb">id</span>
    <span class="n">field</span> <span class="ss">author_type: </span><span class="n">type</span>
  <span class="k">end</span>

  <span class="n">relationship</span> <span class="ss">:comments</span> <span class="k">do</span> <span class="o">|</span><span class="n">_rel</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">_types</span><span class="o">|</span>
    <span class="n">field</span> <span class="ss">comment_ids: </span><span class="n">ids</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Will allow to build the following hash:</span>
<span class="c1"># =&gt; {</span>
<span class="c1">#      type: 'posts',</span>
<span class="c1">#      id: '5',</span>
<span class="c1">#      created_at: '2016-11-18',</span>
<span class="c1">#      author_id: '12',</span>
<span class="c1">#      author_type: 'users',</span>
<span class="c1">#      comment_ids: ['54', '32', '72']</span>
<span class="c1">#    }</span>
</code></pre>
<p>The principle is simple: mapping values of elements of the input payload to
fields of the result hash.</p>

<p>In other words, you declare which elements you are interested in, and which
fields you want to build from them (choosing the name and the value of the
field). If the targeted element does not exist in the payload, the corresponding
fields are not defined.</p>

<h2>Type</h2>

<p>The type of the primary data can be accessed via the <code>type</code> DSL method. If no
block is given, it will create a field named <code>type</code>.</p>

<p>Example:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">DeserializablePost</span> <span class="o">&lt;</span> <span class="no">JSONAPI</span><span class="o">::</span><span class="no">Deserializable</span><span class="o">::</span><span class="no">Post</span>
  <span class="c1"># ...</span>
  <span class="n">type</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
    <span class="n">field</span> <span class="ss">primary_type: </span><span class="n">t</span><span class="p">.</span><span class="nf">capitalize</span>
  <span class="k">end</span>

  <span class="c1"># or</span>
  <span class="n">type</span>  <span class="c1"># implicitly expanded to `type { |t| field type: t }</span>
<span class="k">end</span>
</code></pre>
<h2>Id</h2>

<p>The id of the primary data can be accessed via the <code>id</code> DSL method. If no
block is given, it will create a field named <code>id</code>.</p>

<p>Example:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">DeserializablePost</span> <span class="o">&lt;</span> <span class="no">JSONAPI</span><span class="o">::</span><span class="no">Deserializable</span><span class="o">::</span><span class="no">Post</span>
  <span class="c1"># ...</span>
  <span class="nb">id</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
    <span class="n">field</span> <span class="ss">primary_id: </span><span class="nb">id</span><span class="p">.</span><span class="nf">to_i</span>
  <span class="k">end</span>

  <span class="c1"># or</span>
  <span class="nb">id</span>  <span class="c1"># implicitly expanded to `id { |i| field id: i }</span>
<span class="k">end</span>
</code></pre>
<h2>Attributes</h2>

<p>Attributes of the primary data can be accessed via the <code>attribute</code> DSL method.
The <code>attribute</code> method takes a symbol representing the name of the targeted
attribute in the input payload, and a block to define field(s) of the resulting
hash.</p>

<p>If no block is given, it will create a field with the same name.</p>

<p>Example:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">DeserializablePost</span> <span class="o">&lt;</span> <span class="no">JSONAPI</span><span class="o">::</span><span class="no">Deserializable</span><span class="o">::</span><span class="no">Post</span>
  <span class="c1"># ...</span>
  <span class="n">attribute</span> <span class="ss">:date</span> <span class="k">do</span> <span class="o">|</span><span class="n">d</span><span class="o">|</span>
    <span class="n">field</span> <span class="ss">created_at: </span><span class="n">d</span>
  <span class="k">end</span>

  <span class="c1"># or</span>
  <span class="n">attribute</span> <span class="ss">:date</span>  <span class="c1"># implicitly expanded to `attribute :date { |d| field date: d }</span>
<span class="k">end</span>
</code></pre>
<h2>Relationships</h2>

<p>Relationships of the primary data can be accessed via the <code>has_many</code> and
<code>has_one</code> DSL methods.</p>

<h3>To-many relationships</h3>

<p>The <code>has_many</code> DSL method takes a symbol representing the name of the targeted
relationship in the input payload, and a block to define field(s) of the
resulting hash. The block is called with three parameters: <code>relationship</code> (the
whole relationship hash of the input payload), <code>ids</code> (an array of the ids of
related resources), and <code>types</code> (an array of types of the related resources).</p>

<p>Example:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">DeserializablePost</span> <span class="o">&lt;</span> <span class="no">JSONAPI</span><span class="o">::</span><span class="no">Deserializable</span><span class="o">::</span><span class="no">Post</span>
  <span class="c1"># ...</span>
  <span class="n">has_many</span> <span class="ss">:comments</span> <span class="k">do</span> <span class="o">|</span><span class="n">rel</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">types</span><span class="o">|</span>
    <span class="n">field</span> <span class="ss">comment_ids: </span><span class="n">ids</span>
    <span class="n">field</span> <span class="ss">comment_types: </span><span class="n">types</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">)</span>
    <span class="n">field</span> <span class="ss">comment_meta: </span><span class="n">rel</span><span class="p">[</span><span class="s1">'meta'</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<h3>To-one relationships</h3>

<p>The <code>has_one</code> DSL method takes a symbol representing the name of the targeted
relationship in the input payload, and a block to define field(s) of the
resulting hash. The block is called with three parameters: <code>relationship</code> (the
whole relationship hash of the input payload), <code>id</code> (the id of the related
resource), and <code>type</code> (the type of the related resource).</p>

<p>Example:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">DeserializablePost</span> <span class="o">&lt;</span> <span class="no">JSONAPI</span><span class="o">::</span><span class="no">Deserializable</span><span class="o">::</span><span class="no">Post</span>
  <span class="c1"># ...</span>
  <span class="n">has_one</span> <span class="ss">:author</span> <span class="k">do</span> <span class="o">|</span><span class="n">rel</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">type</span><span class="o">|</span>
    <span class="n">field</span> <span class="ss">author_id: </span><span class="nb">id</span>
    <span class="n">field</span> <span class="ss">author_type: </span><span class="n">type</span><span class="p">.</span><span class="nf">capitalize</span>
    <span class="n">field</span> <span class="ss">author_meta: </span><span class="n">rel</span><span class="p">[</span><span class="s1">'meta'</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<h2>Meta</h2>

<p>Not available yet.</p>

<h2>Links</h2>

<p>Not available yet.</p>

<h2>Generators</h2>

<h3>Rails</h3>

<p>The jsonapi-rails gem comes with generators for deserializable resource classes.
They infer the attributes and relationships from your model definition.</p>

<p>Usage:</p>
<pre class="highlight plaintext"><code>$ bundle exec rails generate jsonapi:deserializable Post
&gt;   created  app/deserializable/deserializable_post.rb
</code></pre>
<h3>Hanami</h3>

<p>Not available yet.</p>

    </div>

    <div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-sm-3 m-b">
        <ul class="list-unstyled list-spaced">
          <li><h6 class="text-uppercase">Project</h6></li>
          <li><a href="https://github.com/jsonapi-rb" target="_blank">GitHub</a></li>
          <li><a href="https://rubygems.org/gems/jsonapi-rb" target="_blank">Rubygems</a></li>
        </ul>
      </div>
      <div class="col-sm-3 m-b">
        <ul class="list-unstyled list-spaced">
          <li><h6 class="text-uppercase">Community</h6></li>
          <li><a href="https://gitter.im/jsonapi-rb" target="_blank">Chat</a></li>
          <li><a href="https://stackoverflow.com/questions/tagged/jsonapi-rb" target="_blank">StackOverflow</a></li>
        </ul>
      </div>
      <div class="col-sm-6">
        <h6 class="text-uppercase">About</h6>
        <p>
          jsonapi-rb is a <a href="http://jsonapi.org">JSON API</a> framework for ruby &mdash; &copy; 2016-2016 <a href="http://lucashosseini.com" target="_blank">Lucas Hosseini</a>.<br>
          Released under the <a href="https://opensource.org/licenses/MIT" target="_blank">MIT License</a>.
        </p>
      </div>
    </div>
  </div>
</div>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-87685934-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
